<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: https:; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com;">
    <title>Pergamon GÃ¼venlik Okulu - YÃ¶netim Sistemi</title>
    <link rel="stylesheet" href="./public/css/default.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <!-- Flatpickr CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.13/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.13/themes/material_green.min.css">

    <style>
        .filter-tab {
            transition: all 0.2s ease-in-out !important;
            cursor: pointer !important;
            user-select: none !important;
        }

        .filter-tab:hover {
            background-color: rgba(255, 255, 255, 0.8) !important;
            transform: translateY(-1px) !important;
        }

        .filter-tab.active {
            background: white !important;
            color: #16a34a !important;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1) !important;
            font-weight: 600 !important;
        }
    </style>
</head>

<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <!-- Logo -->
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">GÃœ</div>
                    <div class="logo-text">
                        <h1>Pergamon GÃ¼venlik Okulu</h1>
                        <p>YÃ¶netim Sistemi</p>
                    </div>
                </div>
            </div>

            <!-- Navigation -->
            <nav class="sidebar-nav">
                <ul class="nav-list">
                    <!--li class="nav-item">
                        <a href="#" class="nav-link active" data-page="dashboard">
                            <i class="fas fa-home"></i>
                            <span class="nav-text">Dashboard</span>
                        </a>
                    </li-->
                    <!--li class="nav-item">
                        <a href="#" class="nav-link" data-page="students">
                            <i class="fas fa-users"></i>
                            <span class="nav-text">Ã–ÄŸrenciler</span>
                        </a>
                    </li-->
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-page="terms">
                            <i class="fas fa-calendar-alt"></i>
                            <span class="nav-text">DÃ¶nemler</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-page="payments">
                            <i class="fas fa-credit-card"></i>
                            <span class="nav-text">Ã–demeler</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-page="notifications">
                            <i class="fas fa-bell"></i>
                            <span class="nav-text">Bildirimler</span>
                        </a>
                    </li>
                    <!--li class="nav-item">
                        <a href="#" class="nav-link" data-page="settings">
                            <i class="fas fa-cog"></i>
                            <span class="nav-text">Ayarlar</span>
                        </a>
                    </li-->
                </ul>
            </nav>

            <!-- Collapse Button -->
            <div class="sidebar-footer">
                <button class="collapse-btn" id="collapseBtn">
                    <i class="fas fa-chevron-left"></i>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-content">
                    <div class="header-info">
                        <h1 id="pageTitle">Dashboard</h1>
                        <p id="pageDescription">Genel sistem durumunu gÃ¶rÃ¼ntÃ¼leyin</p>
                    </div>

                    <div class="header-actions">
                        <!--div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" placeholder="Ara..." id="searchInput">
                        </div-->
                        <button class="notification-btn" onclick="switchPage('notifications')">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge"></span>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Content Area -->
            <div class="content-area">
                <!-- Dashboard Content -->
                <div class="page-content active" id="dashboard-content">
                    <!-- Stats Grid -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-info">
                                <h3>Toplam Ã–ÄŸrenci</h3>
                                <p class="stat-value">245</p>
                                <span class="stat-trend positive">
                                    <i class="fas fa-trending-up"></i>
                                    +12% bu ay
                                </span>
                            </div>
                            <div class="stat-icon users">
                                <i class="fas fa-users"></i>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-info">
                                <h3>Aktif DÃ¶nemler</h3>
                                <p class="stat-value">8</p>
                            </div>
                            <div class="stat-icon calendar">
                                <i class="fas fa-calendar-alt"></i>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-info">
                                <h3>Yeni Ã–ÄŸrenciler</h3>
                                <p class="stat-value">23</p>
                                <span class="stat-trend positive">
                                    <i class="fas fa-trending-up"></i>
                                    +8% geÃ§en aya gÃ¶re
                                </span>
                            </div>
                            <div class="stat-icon new-users">
                                <i class="fas fa-user-check"></i>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-info">
                                <h3>Bekleyen Ã–demeler</h3>
                                <p class="stat-value">15,750 â‚º</p>
                            </div>
                            <div class="stat-icon payments">
                                <i class="fas fa-dollar-sign"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Charts and Activities -->
                    <div class="dashboard-grid">
                        <!-- Chart Area -->
                        <div class="chart-card">
                            <h3>AylÄ±k KayÄ±t Trendi</h3>
                            <div class="chart-placeholder">
                                <i class="fas fa-chart-line"></i>
                                <p>Grafik burada gÃ¶rÃ¼ntÃ¼lenecek</p>
                            </div>
                        </div>

                        <!-- Recent Activities -->
                        <div class="activities-card">
                            <h3>Son Aktiviteler</h3>
                            <div class="activities-list">
                                <div class="activity-item">
                                    <div class="activity-dot enrollment"></div>
                                    <div class="activity-info">
                                        <h4>Ahmet YÄ±lmaz</h4>
                                        <p>Yeni kayÄ±t</p>
                                        <span>2 saat Ã¶nce</span>
                                    </div>
                                </div>
                                <div class="activity-item">
                                    <div class="activity-dot payment"></div>
                                    <div class="activity-info">
                                        <h4>Fatma Kaya</h4>
                                        <p>Ã–deme yapÄ±ldÄ± - 1500 TL</p>
                                        <span>3 saat Ã¶nce</span>
                                    </div>
                                </div>
                                <div class="activity-item">
                                    <div class="activity-dot completion"></div>
                                    <div class="activity-info">
                                        <h4>Mehmet Demir</h4>
                                        <p>DÃ¶nem tamamlandÄ±</p>
                                        <span>1 gÃ¼n Ã¶nce</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Alerts -->
                    <div class="alerts-section">
                        <h3>
                            <i class="fas fa-exclamation-circle"></i>
                            Dikkat Gereken Durumlar
                        </h3>
                        <div class="alerts-grid">
                            <div class="alert-card danger">
                                <h4>Geciken Ã–demeler</h4>
                                <p class="alert-value">7 Ã–ÄŸrenci</p>
                            </div>
                            <div class="alert-card warning">
                                <h4>DÃ¶nem BitiÅŸ UyarÄ±sÄ±</h4>
                                <p class="alert-value">3 DÃ¶nem</p>
                            </div>
                            <div class="alert-card info">
                                <h4>Bekleyen BaÅŸvurular</h4>
                                <p class="alert-value">12 BaÅŸvuru</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Terms Content -->
                <div class="page-content" id="terms-content">
                    <!-- Terms Header -->
                    <div class="page-header">
                        <div class="page-header-info">
                            <h2>DÃ¶nemler</h2>
                            <p>EÄŸitim dÃ¶nemlerini yÃ¶netin</p>
                        </div>
                        <button class="btn btn-primary" onclick="addNewTerm()">
                            <i class="fas fa-plus"></i>
                            Yeni DÃ¶nem
                        </button>
                    </div>

                    <!-- Advanced Filters -->
                    <div class="filters-section">
                        <!-- Status Filters -->
                        <div class="filter-group">
                            <label class="filter-label">Durum:</label>
                            <div class="filter-tabs">
                                <button class="filter-tab active" data-filter="all" data-type="status">TÃ¼mÃ¼</button>
                                <button class="filter-tab" data-filter="Aktif" data-type="status">Aktif</button>
                                <button class="filter-tab" data-filter="YaklaÅŸan" data-type="status">YaklaÅŸan</button>
                                <button class="filter-tab" data-filter="TamamlandÄ±"
                                    data-type="status">TamamlandÄ±</button>
                            </div>
                        </div>

                        <!-- Type Filters -->
                        <div class="filter-group">
                            <label class="filter-label">TÃ¼r:</label>
                            <div class="filter-tabs">
                                <button class="filter-tab active" data-filter="all" data-type="type">TÃ¼mÃ¼</button>
                                <button class="filter-tab" data-filter="Temel" data-type="type">Temel</button>
                                <button class="filter-tab" data-filter="Yenileme" data-type="type">Yenileme</button>
                            </div>
                        </div>

                        <!-- Sort Options -->
                        <div class="filter-group">
                            <label class="filter-label">SÄ±rala:</label>
                            <select class="sort-select" id="sortSelect">
                                <option value="date_newest">En Yeni BaÅŸlangÄ±Ã§ Tarihi</option>
                                <option value="date_oldest">En Eski BaÅŸlangÄ±Ã§ Tarihi</option>
                                <option value="students_desc">Ã–ÄŸrenci SayÄ±sÄ± (Fazla â†’ Az)</option>
                                <option value="students_asc">Ã–ÄŸrenci SayÄ±sÄ± (Az â†’ Fazla)</option>
                                <option value="term_number_desc">DÃ¶nem No (BÃ¼yÃ¼k â†’ KÃ¼Ã§Ã¼k)</option>
                                <option value="term_number_asc">DÃ¶nem No (KÃ¼Ã§Ã¼k â†’ BÃ¼yÃ¼k)</option>
                            </select>
                        </div>

                        <!-- Search -->
                        <div class="filter-group">
                            <label class="filter-label">Ara:</label>
                            <div class="advanced-search">
                                <i class="fas fa-search"></i>
                                <input type="text" placeholder="DÃ¶nem no, tÃ¼r veya durum ara..." id="termsSearchInput">
                                <button class="clear-search" id="clearSearch" style="display: none;">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Terms Table Card -->
                    <div class="table-card">
                        <div class="table-container">
                            <table class="terms-table" id="termsTable">
                                <thead>
                                    <tr>
                                        <th>DÃ¶nem No</th>
                                        <th>DÃ¶nem TÃ¼rÃ¼</th>
                                        <th>Durum</th>
                                        <th>Ã–ÄŸrenci SayÄ±sÄ±</th>
                                        <th>BaÅŸlangÄ±Ã§ Tarihi</th>
                                        <th>BitiÅŸ Tarihi</th>
                                        <th>Ä°ÅŸlemler</th>
                                    </tr>
                                </thead>
                                <tbody id="termsTableBody">
                                    <!-- Terms will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Other Pages (Placeholder) -->
                <div class="page-content" id="students-content">
                    <div class="placeholder-content">
                        <i class="fas fa-users"></i>
                        <h3>Ã–ÄŸrenciler</h3>
                        <p>Bu sayfa yakÄ±nda gelecek...</p>
                    </div>
                </div>

                <!-- ODEMELER SAYFASI - TÃœM YAPISI -->
                <div class="page-content" id="payments-content">
                    <!-- Page Header -->
                    <div class="page-header">
                        <div class="page-header-info">
                            <h2>Ã–demeler</h2>
                            <p>Ã–ÄŸrenci Ã¶demelerini yÃ¶netin ve takip edin</p>
                        </div>
                        <div class="header-actions">
                            <button class="btn btn-secondary" onclick="exportPayments()">
                                <i class="fas fa-download"></i>
                                Rapor Ä°ndir
                            </button>
                        </div>
                    </div>

                    <!-- Stats Grid -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-card-content">
                                <div class="stat-info">
                                    <h3>Toplam Ã–deme</h3>
                                    <div class="stat-value">â‚º248,750</div>
                                    <div class="stat-trend positive">
                                        <i class="fas fa-trending-up"></i>
                                        +18% bu ay
                                    </div>
                                </div>
                                <div class="stat-icon total-payments">
                                    <i class="fas fa-coins"></i>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-card-content">
                                <div class="stat-info">
                                    <h3>Bekleyen Ã–demeler</h3>
                                    <div class="stat-value">â‚º52,400</div>
                                    <div class="stat-trend negative">
                                        <i class="fas fa-clock"></i>
                                        23 Ã¶ÄŸrenci
                                    </div>
                                </div>
                                <div class="stat-icon pending-payments">
                                    <i class="fas fa-hourglass-half"></i>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-card-content">
                                <div class="stat-info">
                                    <h3>Tamamlanan</h3>
                                    <div class="stat-value">â‚º196,350</div>
                                    <div class="stat-trend positive">
                                        <i class="fas fa-check-circle"></i>
                                        147 Ã¶deme
                                    </div>
                                </div>
                                <div class="stat-icon completed-payments">
                                    <i class="fas fa-check-double"></i>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-card-content">
                                <div class="stat-info">
                                    <h3>Geciken Ã–demeler</h3>
                                    <div class="stat-value">12</div>
                                    <div class="stat-trend negative">
                                        <i class="fas fa-exclamation-triangle"></i>
                                        Acil takip
                                    </div>
                                </div>
                                <div class="stat-icon overdue-payments">
                                    <i class="fas fa-clock"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Filters Section -->
                    <div class="filters-section">
                        <div class="filters-grid">
                            <!-- Ã–ÄŸrenci Arama -->
                            <div class="filter-group">
                                <label for="studentSearch">Ã–ÄŸrenci Ara</label>
                                <input type="text" id="studentSearch" class="filter-input"
                                    placeholder="Ad, soyad veya TC ile ara..." onkeyup="applyPaymentFilters()"
                                    style="width: 155px; height: 36px; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px;">
                            </div>

                            <!-- DÃ¶nem Filtresi -->
                            <div class="filter-group">
                                <label for="termFilter">DÃ¶nem</label>
                                <select id="termFilter" class="filter-select" onchange="applyPaymentFilters()">
                                    <option value="">TÃ¼m DÃ¶nemler</option>
                                    <!-- JavaScript ile doldurulacak -->
                                </select>
                            </div>

                            <!-- Durum Filtresi -->
                            <div class="filter-group">
                                <label for="statusFilter">Ã–deme Durumu</label>
                                <select id="statusFilter" class="filter-select" onchange="applyPaymentFilters()">
                                    <option value="">TÃ¼m Durumlar</option>
                                    <option value="odendi">Ã–dendi</option>
                                    <option value="bekliyor">Bekliyor</option>
                                    <option value="geciken">Geciken</option>
                                </select>
                            </div>

                            <!-- Ã–deme TÃ¼rÃ¼ -->
                            <div class="filter-group">
                                <label for="paymentTypeFilter">Ã–deme TÃ¼rÃ¼</label>
                                <select id="paymentTypeFilter" class="filter-select" onchange="applyPaymentFilters()">
                                    <option value="">TÃ¼mÃ¼</option>
                                    <option value="tam">Tam Ã–deme</option>
                                    <option value="taksit">Taksit</option>
                                </select>
                            </div>

                            <!-- Ã–deme YÃ¶ntemi -->
                            <div class="filter-group">
                                <label for="paymentMethodFilter">Ã–deme YÃ¶ntemi</label>
                                <select id="paymentMethodFilter" class="filter-select" onchange="applyPaymentFilters()">
                                    <option value="">TÃ¼mÃ¼</option>
                                    <option value="nakit">Nakit</option>
                                    <option value="kart">Kart</option>
                                    <option value="havale">Havale</option>
                                </select>
                            </div>

                            <!-- Tarih AralÄ±ÄŸÄ± -->
                            <div class="filter-group">
                                <label for="dateRange">Tarih AralÄ±ÄŸÄ±</label>
                                <input type="text" id="dateRange" class="filter-input"
                                    placeholder="Tarih aralÄ±ÄŸÄ± seÃ§in...">
                            </div>

                            <!-- Filtrele Butonu -->
                            <div class="filter-group">
                                <button class="filter-btn" onclick="applyPaymentFilters()">
                                    <i class="fas fa-search"></i>
                                    Filtrele
                                </button>
                            </div>

                            <!-- Temizle Butonu -->
                            <div class="filter-group">
                                <button class="filter-btn" onclick="clearPaymentFilters()" style="background: #6b7280;">
                                    <i class="fas fa-times"></i>
                                    Temizle
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Payments Table Section -->
                    <div class="payments-table-section">
                        <div class="table-header">
                            <div class="table-title">
                                <i class="fas fa-table"></i>
                                <span>Ã–deme Listesi</span>
                                <span class="table-count" id="paymentsCount">(0)</span>
                            </div>
                            <div class="table-actions">
                                <button class="btn btn-secondary btn-sm" onclick="refreshPayments()">
                                    <i class="fas fa-sync-alt"></i>
                                    Yenile
                                </button>
                            </div>
                        </div>

                        <div class="table-container">
                            <table class="payments-table">
                                <thead>
                                    <tr>
                                        <th>Ã–ÄŸrenci</th>
                                        <th>DÃ¶nem</th>
                                        <th>Ã–deme TutarÄ±</th>
                                        <th>Ã–deme Tarihi</th>
                                        <th>Ã–deme YÃ¶ntemi</th>
                                        <th>Ã–deme TÃ¼rÃ¼</th>
                                        <th>Notlar</th>
                                        <th>Ä°ÅŸlemler</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- JavaScript ile doldurulacak -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="page-content" id="notifications-content" style="display: none;">

                    <!-- Page Header -->
                    <div class="page-header">
                        <div class="page-header-info">
                            <h2>Bildirimler</h2>
                            <p>Sistem bildirimlerini yÃ¶netin ve takip edin</p>
                        </div>
                        <div class="header-actions">
                            <button class="btn btn-secondary" onclick="runManualNotificationCheck()">
                                <i class="fas fa-sync"></i>
                                Manuel Kontrol
                            </button>
                            <button class="btn btn-primary" onclick="markAllNotificationsRead()">
                                <i class="fas fa-check-double"></i>
                                TÃ¼mÃ¼nÃ¼ Okundu Ä°ÅŸaretle
                            </button>
                        </div>
                    </div>

                    <!-- Ä°statistik KartlarÄ± -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-card-content">
                                <div class="stat-info">
                                    <h3>Toplam Bildirim</h3>
                                    <div class="stat-value" id="totalNotifications">0</div>
                                    <div class="stat-trend neutral">
                                        <i class="fas fa-bell"></i>
                                        Sistem geneli
                                    </div>
                                </div>
                                <div class="stat-icon total-notifications">
                                    <i class="fas fa-bell"></i>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-card-content">
                                <div class="stat-info">
                                    <h3>OkunmamÄ±ÅŸ</h3>
                                    <div class="stat-value" id="unreadNotifications">0</div>
                                    <div class="stat-trend negative">
                                        <i class="fas fa-exclamation-circle"></i>
                                        Dikkat gerekli
                                    </div>
                                </div>
                                <div class="stat-icon unread-notifications">
                                    <i class="fas fa-bell-slash"></i>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-card-content">
                                <div class="stat-info">
                                    <h3>Acil Durumlar</h3>
                                    <div class="stat-value" id="urgentNotifications">0</div>
                                    <div class="stat-trend negative">
                                        <i class="fas fa-exclamation-triangle"></i>
                                        Hemen iÅŸlem yapÄ±n
                                    </div>
                                </div>
                                <div class="stat-icon urgent-notifications">
                                    <i class="fas fa-exclamation-triangle"></i>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-card-content">
                                <div class="stat-info">
                                    <h3>BugÃ¼n</h3>
                                    <div class="stat-value" id="todayNotifications">0</div>
                                    <div class="stat-trend positive">
                                        <i class="fas fa-calendar-day"></i>
                                        Yeni bildirimler
                                    </div>
                                </div>
                                <div class="stat-icon today-notifications">
                                    <i class="fas fa-calendar-check"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Filtreler ve Arama -->
                    <div class="filters-section">
                        <!-- TÃ¼r Filtreleri -->
                        <div class="filter-group">
                            <label class="filter-label">TÃ¼r:</label>
                            <div class="filter-tabs">
                                <button class="filter-tab active" data-filter="all" data-type="type">TÃ¼mÃ¼</button>
                                <button class="filter-tab" data-filter="egitim" data-type="type">
                                    <i class="fas fa-graduation-cap"></i> EÄŸitim
                                </button>
                                <button class="filter-tab" data-filter="odeme" data-type="type">
                                    <i class="fas fa-credit-card"></i> Ã–deme
                                </button>
                                <button class="filter-tab" data-filter="belge" data-type="type">
                                    <i class="fas fa-file-alt"></i> Belge
                                </button>
                                <button class="filter-tab" data-filter="kimlik_suresi" data-type="type">
                                    <i class="fas fa-id-card"></i> Kimlik SÃ¼resi
                                </button>
                            </div>
                        </div>

                        <!-- Durum Filtreleri -->
                        <div class="filter-group">
                            <label class="filter-label">Durum:</label>
                            <div class="filter-tabs">
                                <button class="filter-tab active" data-filter="all" data-type="status">TÃ¼mÃ¼</button>
                                <button class="filter-tab" data-filter="okunmamis" data-type="status">
                                    <i class="fas fa-eye-slash"></i> OkunmamÄ±ÅŸ
                                </button>
                                <button class="filter-tab" data-filter="okunmus" data-type="status">
                                    <i class="fas fa-eye"></i> OkunmuÅŸ
                                </button>
                            </div>
                        </div>

                        <!-- Ã–ncelik Filtreleri -->
                        <div class="filter-group">
                            <label class="filter-label">Ã–ncelik:</label>
                            <div class="filter-tabs">
                                <button class="filter-tab active" data-filter="all" data-type="priority">TÃ¼mÃ¼</button>
                                <button class="filter-tab" data-filter="acil" data-type="priority">
                                    <i class="fas fa-exclamation-triangle"></i> Acil
                                </button>
                                <button class="filter-tab" data-filter="onemli" data-type="priority">
                                    <i class="fas fa-exclamation-circle"></i> Ã–nemli
                                </button>
                                <button class="filter-tab" data-filter="bilgi" data-type="priority">
                                    <i class="fas fa-info-circle"></i> Bilgi
                                </button>
                            </div>
                        </div>

                        <!-- Arama ve Toplu Ä°ÅŸlemler -->
                        <div class="filter-group" style="margin-left: auto;">
                            <div class="search-box">
                                <i class="fas fa-search"></i>
                                <input type="text" placeholder="Bildirim ara..." id="notificationSearch">
                            </div>
                            <button class="btn btn-danger" onclick="deleteSelectedNotifications()"
                                style="margin-left: 10px;">
                                <i class="fas fa-trash"></i>
                                SeÃ§ilenleri Sil
                            </button>
                        </div>
                    </div>

                    <!-- Bildirimler Listesi -->
                    <div class="notifications-container">
                        <!-- Loading State -->
                        <div id="notifications-loading"
                            style="text-align: center; padding: 40px; color: #6b7280; display: block;">
                            <i class="fas fa-spinner fa-spin" style="font-size: 24px; margin-bottom: 12px;"></i>
                            <div>Bildirimler yÃ¼kleniyor...</div>
                        </div>

                        <!-- Empty State -->
                        <div id="notifications-empty"
                            style="text-align: center; padding: 60px; color: #6b7280; display: none;">
                            <i class="fas fa-bell-slash"
                                style="font-size: 48px; margin-bottom: 16px; color: #d1d5db;"></i>
                            <h3 style="margin-bottom: 8px;">Bildirim bulunamadÄ±</h3>
                            <p>HenÃ¼z hiÃ§ bildirim oluÅŸturulmamÄ±ÅŸ veya filtrelerinizle eÅŸleÅŸen bildirim yok.</p>
                            <button class="btn btn-primary" onclick="runManualNotificationCheck()"
                                style="margin-top: 16px;">
                                <i class="fas fa-sync"></i>
                                Manuel Kontrol Yap
                            </button>
                        </div>

                        <!-- Bildirimler Tablosu -->
                        <div id="notifications-table" style="display: none;">
                            <div class="table-header"
                                style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
                                <div>
                                    <input type="checkbox" id="selectAllNotifications"
                                        onchange="selectAllNotifications()">
                                    <label for="selectAllNotifications"
                                        style="margin-left: 8px; font-weight: 500;">TÃ¼mÃ¼nÃ¼ SeÃ§</label>
                                </div>
                                <div class="table-info">
                                    <span id="notificationCount">0 bildirim</span>
                                </div>
                            </div>

                            <div class="notifications-list" id="notificationsList">
                                <!-- Bildirimler buraya JavaScript ile eklenecek -->
                            </div>
                        </div>
                    </div>

                    <!-- Pagination -->
                    <div class="pagination-container" id="notificationsPagination" style="display: none;">
                        <div class="pagination">
                            <button class="pagination-btn" id="prevPageBtn" onclick="changePage(-1)">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <div class="pagination-info">
                                <span id="currentPageInfo">Sayfa 1 / 1</span>
                            </div>
                            <button class="pagination-btn" id="nextPageBtn" onclick="changePage(1)">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Bildirim Detay Modal - BODY'Ä°N SONUNA (diÄŸer modal'larÄ±n yanÄ±na) EKLENÄ°R -->
                <div id="notificationDetailModal" class="modal-overlay" style="display: none;">
                    <div class="modal-container" style="max-width: 800px;">
                        <div class="modal-header">
                            <h2>
                                <i class="fas fa-bell"></i>
                                Bildirim DetaylarÄ±
                            </h2>
                            <button onclick="closeNotificationDetailModal()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body" id="notificationDetailContent">
                            <!-- Detay iÃ§eriÄŸi buraya gelecek -->
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" onclick="closeNotificationDetailModal()">
                                <i class="fas fa-times"></i>
                                Kapat
                            </button>
                            <button type="button" class="btn btn-primary" id="markAsReadBtn"
                                onclick="markNotificationAsRead()">
                                <i class="fas fa-check"></i>
                                Okundu Ä°ÅŸaretle
                            </button>
                        </div>
                    </div>
                </div>

        </main>
    </div>

    <!-- Add Term Modal -->
    <div class="modal-overlay" id="addTermModal">
        <div class="modal-container">
            <div class="modal-header">
                <h2>
                    <i class="fas fa-plus-circle"></i>
                    Yeni DÃ¶nem Ekle
                </h2>
                <button class="modal-close" onclick="closeAddTermModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="modal-body">
                <!-- Form Progress Indicator -->
                <div class="form-progress">
                    <div class="form-progress-bar" id="formProgressBar"></div>
                </div>

                <form id="addTermForm" class="term-form">
                    <!-- DÃ¶nem NumarasÄ± -->
                    <div class="form-group">
                        <label for="termNumber" class="form-label">
                            <i class="fas fa-hashtag"></i>
                            DÃ¶nem NumarasÄ±
                        </label>
                        <input type="number" id="termNumber" name="donem_numara" class="form-input"
                            placeholder="Ã–rn: 2024001" required min="1">
                        <small class="form-help">Benzersiz bir dÃ¶nem numarasÄ± girin</small>
                    </div>

                    <!-- DÃ¶nem TÃ¼rÃ¼ -->
                    <div class="form-group">
                        <label for="termType" class="form-label">
                            <i class="fas fa-tag"></i>
                            DÃ¶nem TÃ¼rÃ¼
                        </label>
                        <select id="termType" name="donem_turu" class="form-select" required>
                            <option value="">SeÃ§iniz...</option>
                            <option value="Temel">ðŸ“š Temel EÄŸitim</option>
                            <option value="Yenileme">ðŸ”„ Yenileme EÄŸitimi</option>
                        </select>
                    </div>

                    <!-- Ã–ÄŸrenci SayÄ±sÄ± - Sadece dÃ¼zenleme modunda gÃ¶rÃ¼nÃ¼r -->
                    <div class="form-group" style="display: none;">
                        <label for="studentCount" class="form-label">
                            <i class="fas fa-users"></i>
                            KayÄ±tlÄ± Ã–ÄŸrenci SayÄ±sÄ±
                        </label>
                        <input type="number" id="studentCount" name="donem_ogr_adedi" class="form-input" placeholder="0"
                            min="0" max="500" disabled>
                        <small class="form-help">Bu alan sadece gÃ¶rÃ¼ntÃ¼leme iÃ§indir</small>
                    </div>

                    <!-- Tarih AralÄ±ÄŸÄ± -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="startDate" class="form-label">
                                <i class="fas fa-calendar-plus"></i>
                                BaÅŸlangÄ±Ã§ Tarihi
                            </label>
                            <input type="text" id="startDate" name="donem_baslangic_t" class="form-input date-picker"
                                placeholder="GÃ¼n/Ay/YÄ±l seÃ§in" readonly required>
                            <small class="form-help">DÃ¶nem baÅŸlangÄ±Ã§ tarihini seÃ§in</small>
                        </div>

                        <div class="form-group">
                            <label for="endDate" class="form-label">
                                <i class="fas fa-calendar-check"></i>
                                BitiÅŸ Tarihi
                            </label>
                            <input type="text" id="endDate" name="donem_bitis_t" class="form-input date-picker"
                                placeholder="GÃ¼n/Ay/YÄ±l seÃ§in" readonly required>
                            <small class="form-help">DÃ¶nem bitiÅŸ tarihini seÃ§in</small>
                        </div>
                    </div>

                    <!-- Quick Stats - Sadece dÃ¼zenleme modunda -->
                    <div class="modal-quick-stats" id="modalQuickStats" style="display: none;">
                        <div class="quick-stat">
                            <span class="quick-stat-value" id="termDurationStat">0</span>
                            <span class="quick-stat-label">GÃ¼n</span>
                        </div>
                        <div class="quick-stat">
                            <span class="quick-stat-value" id="studentsPerDayStat">0</span>
                            <span class="quick-stat-label">Ã–ÄŸr/GÃ¼n</span>
                        </div>
                        <div class="quick-stat">
                            <span class="quick-stat-value" id="completionRateStat">0%</span>
                            <span class="quick-stat-label">Tamamlanma</span>
                        </div>
                    </div>

                    <!-- Form Validation Info -->
                    <div class="form-info">
                        <div class="info-item">
                            <i class="fas fa-lightbulb"></i>
                            <span>DÃ¶nem durumu tarihlere gÃ¶re otomatik hesaplanacak</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-users"></i>
                            <span>Ã–ÄŸrenci sayÄ±sÄ± dÃ¶nem iÃ§ine kayÄ±t yapÄ±ldÄ±kÃ§a artacak</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span>DÃ¶nem numarasÄ± benzersiz olmalÄ±dÄ±r</span>
                        </div>
                    </div>
                </form>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeAddTermModal()">
                    <i class="fas fa-times"></i>
                    Ä°ptal
                </button>
                <button type="submit" form="addTermForm" class="btn btn-primary" id="saveTermBtn">
                    <i class="fas fa-save"></i>
                    DÃ¶nem Ekle
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.13/flatpickr.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.13/l10n/tr.min.js"></script>
    <script src="./public/js/notifications-page.js"></script>
    <script>
        // Form progress gÃ¼ncelleme
        function updateFormProgress() {
            const form = document.getElementById('addTermForm');
            const progressBar = document.getElementById('formProgressBar');

            if (!form || !progressBar) return;

            const requiredFields = form.querySelectorAll('[required]');
            let filledFields = 0;

            requiredFields.forEach(field => {
                if (field.value.trim() !== '') {
                    filledFields++;
                }
            });

            const progress = (filledFields / requiredFields.length) * 100;
            progressBar.style.width = progress + '%';
        }

        // Form input'larÄ±na event listener ekle
        document.addEventListener('DOMContentLoaded', function () {
            const form = document.getElementById('addTermForm');
            if (form) {
                const inputs = form.querySelectorAll('input, select');
                inputs.forEach(input => {
                    input.addEventListener('input', updateFormProgress);
                    input.addEventListener('change', updateFormProgress);
                });
            }
            // DÃ¶nem ekleme/dÃ¼zenleme iÃ§in tarih picker'larÄ± baÅŸlat
            setTimeout(() => {
                initializeFlatpickr();
            }, 100);
        });
    </script>
    <script>
        // Flatpickr TÃ¼rkÃ§e KonfigÃ¼rasyonu
        const flatpickrConfig = {
            locale: "tr",
            dateFormat: "d.m.Y",
            allowInput: false,
            clickOpens: true,
            time_24hr: true,
            disableMobile: false, // Mobilde de custom picker kullan
            monthSelectorType: "dropdown",
            yearSelectorType: "dropdown",
            showMonths: 1,
            animate: true,
            theme: "material_green",
            onReady: function (selectedDates, dateStr, instance) {
                // TÃ¼rkÃ§e placeholder text
                instance.input.placeholder = "GÃ¼n/Ay/YÄ±l";
            }
        };

        // Flatpickr baÅŸlatma fonksiyonu
        function initializeFlatpickr() {
            // BaÅŸlangÄ±Ã§ tarihi
            const startDatePicker = flatpickr("#startDate", {
                locale: "tr",
                dateFormat: "d.m.Y",
                allowInput: false,
                clickOpens: true,
                time_24hr: true,
                disableMobile: false,
                monthSelectorType: "dropdown",
                yearSelectorType: "dropdown",
                showMonths: 1,
                animate: true,
                theme: "material_green",
                minDate: "today",
                onChange: function (selectedDates, dateStr, instance) {
                    if (endDatePicker) {
                        endDatePicker.set('minDate', dateStr);
                        if (endDatePicker.selectedDates.length > 0 &&
                            endDatePicker.selectedDates[0] <= selectedDates[0]) {
                            endDatePicker.clear();
                        }
                    }
                    showStatusPreview();
                    updateFormProgress();
                }
            });

            // BitiÅŸ tarihi
            const endDatePicker = flatpickr("#endDate", {
                locale: "tr",
                dateFormat: "d.m.Y",
                allowInput: false,
                clickOpens: true,
                time_24hr: true,
                disableMobile: false,
                monthSelectorType: "dropdown",
                yearSelectorType: "dropdown",
                showMonths: 1,
                animate: true,
                theme: "material_green",
                minDate: "today",
                onChange: function (selectedDates, dateStr, instance) {
                    const startDate = startDatePicker.selectedDates[0];
                    if (startDate && selectedDates[0] <= startDate) {
                        instance.clear();
                        showNotification('BitiÅŸ tarihi baÅŸlangÄ±Ã§ tarihinden sonra olmalÄ±dÄ±r', 'warning');
                        return;
                    }
                    showStatusPreview();
                    updateFormProgress();
                }
            });

            return { startDatePicker, endDatePicker };
        }

        // Sayfa yÃ¼klendiÄŸinde Flatpickr'Ä± baÅŸlat
        document.addEventListener('DOMContentLoaded', function () {
            // DiÄŸer DOMContentLoaded kodlarÄ±ndan sonra
            setTimeout(() => {
                initializeFlatpickr();
            }, 100);
        });
    </script>
    <script src="./public/js/student-utils.js"></script> <!-- YENÄ° -->
    <script src="./public/js/default.js"></script>
    <script src="./public/js/student-edit.js"></script>

    <!-- Veya inline olarak eklemek isterseniz: -->
    <script>
        // Ã–ÄŸrenci dÃ¼zenleme iÅŸlevleri aktif olduÄŸunda Ã§alÄ±ÅŸacak
        document.addEventListener('DOMContentLoaded', function () {
            // Mevcut editStudentDetails fonksiyonunu gÃ¼ncelle
            if (typeof window.editStudentDetails === 'undefined') {
                window.editStudentDetails = async function (studentId) {
                    try {
                        const student = await window.db.getOgrenciById(studentId);

                        if (!student) {
                            showNotification('Ã–ÄŸrenci bulunamadÄ±', 'error');
                            return;
                        }

                        // Basit dÃ¼zenleme modalÄ± aÃ§
                        openSimpleEditModal(student);

                    } catch (error) {
                        console.error('Ã–ÄŸrenci bilgileri yÃ¼klenirken hata:', error);
                        showNotification('Ã–ÄŸrenci bilgileri yÃ¼klenirken hata oluÅŸtu', 'error');
                    }
                };
            }

            console.log('âœ… Ã–ÄŸrenci dÃ¼zenleme iÅŸlevleri aktif edildi!');
        });

        function openSimpleEditModal(student) {
            // Basit bir dÃ¼zenleme modalÄ± oluÅŸtur
            const modalHTML = `
        <div class="modal-overlay active" id="simpleEditModal">
            <div class="modal-container">
                <div class="modal-header">
                    <h2>
                        <i class="fas fa-user-edit"></i>
                        ${student.ogr_ad} ${student.ogr_soyad} - DÃ¼zenle
                    </h2>
                    <button class="modal-close" onclick="closeSimpleEditModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <p style="text-align: center; padding: 40px; color: #6b7280;">
                        <i class="fas fa-tools" style="font-size: 48px; margin-bottom: 16px; color: #16a34a;"></i><br>
                        <strong>Ã–ÄŸrenci DÃ¼zenleme</strong><br>
                        GeliÅŸmiÅŸ dÃ¼zenleme Ã¶zellikleri yakÄ±nda aktif olacak!<br><br>
                        <small>Åžu anda: ${student.ogr_ad} ${student.ogr_soyad} (ID: ${student.id})</small>
                    </p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeSimpleEditModal()">
                        <i class="fas fa-times"></i>
                        Kapat
                    </button>
                    <button type="button" class="btn btn-primary" onclick="viewStudentDetails(${student.id}); closeSimpleEditModal();">
                        <i class="fas fa-eye"></i>
                        DetaylarÄ± GÃ¶rÃ¼ntÃ¼le
                    </button>
                </div>
            </div>
        </div>
    `;

            document.body.insertAdjacentHTML('beforeend', modalHTML);
            document.body.style.overflow = 'hidden';
        }

        function closeSimpleEditModal() {
            const modal = document.getElementById('simpleEditModal');
            if (modal) {
                modal.remove();
                document.body.style.overflow = '';
            }
        }

        // Global fonksiyonlarÄ± tanÄ±mla
        window.openSimpleEditModal = openSimpleEditModal;
        window.closeSimpleEditModal = closeSimpleEditModal;
    </script>

    <!-- Ana Sistem GÃ¼ncellemesi Script'i -->
    <script>
        // Ã–ÄŸrenci dÃ¼zenleme sistemini tamamen aktif et
        document.addEventListener('DOMContentLoaded', function () {

            // DÃ¼zenleme butonlarÄ±nÄ± aktif et
            function activateEditButtons() {
                const editButtons = document.querySelectorAll('.action-btn.edit');
                editButtons.forEach(btn => {
                    if (!btn.onclick) {
                        const studentId = btn.closest('tr')?.dataset.studentId;
                        if (studentId) {
                            btn.onclick = () => editStudentDetails(parseInt(studentId));
                        }
                    }
                });
            }

            // MutationObserver ile dinamik eklenen butonlarÄ± yakala
            const observer = new MutationObserver(function (mutations) {
                mutations.forEach(function (mutation) {
                    if (mutation.addedNodes) {
                        mutation.addedNodes.forEach(function (node) {
                            if (node.nodeType === 1) { // Element node
                                const editButtons = node.querySelectorAll ? node.querySelectorAll('.action-btn.edit') : [];
                                editButtons.forEach(btn => {
                                    const studentId = btn.closest('tr')?.dataset.studentId;
                                    if (studentId && !btn.onclick) {
                                        btn.onclick = () => editStudentDetails(parseInt(studentId));
                                    }
                                });
                            }
                        });
                    }
                });
            });

            // Ã–ÄŸrenci tablosunu gÃ¶zle
            const studentsTable = document.getElementById('students-tbody');
            if (studentsTable) {
                observer.observe(studentsTable, { childList: true, subtree: true });
            }

            // Sayfa yÃ¼klendiÄŸinde mevcut butonlarÄ± aktif et
            setTimeout(activateEditButtons, 1000);

            console.log('ðŸ”§ DÃ¼zenleme butonlarÄ± otomatik olarak aktif ediliyor...');
        });

        // Ã–ÄŸrenci durumu gÃ¼ncelleme fonksiyonu
        async function quickUpdateStudentStatus(studentId, newStatus) {
            try {
                const result = await window.db.runQuery(
                    'UPDATE ogrenciler SET ogr_durum = ? WHERE id = ?',
                    [newStatus, studentId]
                );

                if (result && !result.error) {
                    showNotification(`Ã–ÄŸrenci durumu "${newStatus}" olarak gÃ¼ncellendi`, 'success');

                    // Listeyi yenile
                    if (window.appState?.currentTermId) {
                        window.loadTermStudents(window.appState.currentTermId);
                    }
                } else {
                    throw new Error(result?.error || 'GÃ¼ncelleme baÅŸarÄ±sÄ±z');
                }

            } catch (error) {
                console.error('Durum gÃ¼ncelleme hatasÄ±:', error);
                showNotification('Durum gÃ¼ncellenirken hata oluÅŸtu', 'error');
            }
        }

        // HÄ±zlÄ± iÅŸlemler iÃ§in context menu
        function showStudentContextMenu(event, studentId) {
            event.preventDefault();

            const contextMenu = document.createElement('div');
            contextMenu.className = 'context-menu';
            contextMenu.style.cssText = `
        position: fixed;
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        z-index: 10000;
        min-width: 180px;
        top: ${event.clientY}px;
        left: ${event.clientX}px;
    `;

            contextMenu.innerHTML = `
        <div class="context-menu-item" onclick="viewStudentDetails(${studentId}); removeContextMenu()">
            <i class="fas fa-eye"></i> GÃ¶rÃ¼ntÃ¼le
        </div>
        <div class="context-menu-item" onclick="editStudentDetails(${studentId}); removeContextMenu()">
            <i class="fas fa-edit"></i> DÃ¼zenle
        </div>
        <div class="context-menu-item" onclick="duplicateStudent(${studentId}); removeContextMenu()">
            <i class="fas fa-copy"></i> Kopyala
        </div>
        <hr style="margin: 4px 0; border: none; border-top: 1px solid #e5e7eb;">
        <div class="context-menu-item" onclick="quickUpdateStudentStatus(${studentId}, 'Aktif'); removeContextMenu()">
            <i class="fas fa-check-circle"></i> Aktif Yap
        </div>
        <div class="context-menu-item" onclick="quickUpdateStudentStatus(${studentId}, 'Pasif'); removeContextMenu()">
            <i class="fas fa-pause-circle"></i> Pasif Yap
        </div>
        <div class="context-menu-item" onclick="quickUpdateStudentStatus(${studentId}, 'Mezun'); removeContextMenu()">
            <i class="fas fa-graduation-cap"></i> Mezun Yap
        </div>
        <hr style="margin: 4px 0; border: none; border-top: 1px solid #e5e7eb;">
        <div class="context-menu-item danger" onclick="deleteStudentConfirm(${studentId}); removeContextMenu()">
            <i class="fas fa-trash"></i> Sil
        </div>
    `;

            // CSS ekle
            if (!document.getElementById('contextMenuStyles')) {
                const style = document.createElement('style');
                style.id = 'contextMenuStyles';
                style.textContent = `
            .context-menu-item {
                padding: 8px 12px;
                cursor: pointer;
                display: flex;
                align-items: center;
                gap: 8px;
                font-size: 14px;
                color: #374151;
                transition: background-color 0.2s;
            }
            .context-menu-item:hover {
                background-color: #f3f4f6;
            }
            .context-menu-item.danger {
                color: #dc2626;
            }
            .context-menu-item.danger:hover {
                background-color: #fef2f2;
            }
        `;
                document.head.appendChild(style);
            }

            document.body.appendChild(contextMenu);

            // DÄ±ÅŸarÄ± tÄ±klanÄ±nca kapat
            setTimeout(() => {
                document.addEventListener('click', removeContextMenu, { once: true });
            }, 100);
        }

        function removeContextMenu() {
            const contextMenu = document.querySelector('.context-menu');
            if (contextMenu) {
                contextMenu.remove();
            }
        }

        // Ã–ÄŸrenci satÄ±rlarÄ±na saÄŸ tÄ±k ekle
        function addContextMenuToStudentRows() {
            const studentRows = document.querySelectorAll('#students-tbody tr[data-student-id]');
            studentRows.forEach(row => {
                const studentId = parseInt(row.dataset.studentId);
                if (!row.oncontextmenu) {
                    row.oncontextmenu = (e) => showStudentContextMenu(e, studentId);
                }
            });
        }

        function showStatusPreview() {
            const startDateInput = document.getElementById('startDate');
            const endDateInput = document.getElementById('endDate');
            const formInfo = document.querySelector('.form-info');

            if (!startDateInput || !endDateInput || !formInfo) return;

            const startDateValue = startDateInput.value;
            const endDateValue = endDateInput.value;

            if (startDateValue && endDateValue) {
                const startDate = formatDateForDatabase(startDateValue);
                const endDate = formatDateForDatabase(endDateValue);

                const predictedStatus = calculateTermStatus(startDate, endDate);

                let previewElement = formInfo.querySelector('.auto-status-indicator');
                if (!previewElement) {
                    previewElement = document.createElement('div');
                    previewElement.className = 'auto-status-indicator';
                    previewElement.style.cssText = `
                display: inline-flex;
                align-items: center;
                gap: 6px;
                padding: 8px 12px;
                background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
                border: 1px solid #bbf7d0;
                border-radius: 8px;
                font-size: 13px;
                color: #166534;
                margin-top: 8px;
            `;
                    formInfo.appendChild(previewElement);
                }

                previewElement.innerHTML = `
            <i class="fas fa-magic"></i>
            <span>Hesaplanan durum: <strong style="color: ${getStatusColor(predictedStatus)}">${predictedStatus}</strong></span>
        `;
            }
        }

        function calculateTermStatus(startDate, endDate) {
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            const start = new Date(startDate);
            start.setHours(0, 0, 0, 0);

            const end = new Date(endDate);
            end.setHours(0, 0, 0, 0);

            if (today < start) {
                return 'YaklaÅŸan';
            } else if (today >= start && today <= end) {
                return 'Aktif';
            } else if (today > end) {
                return 'TamamlandÄ±';
            }

            return 'YaklaÅŸan';
        }

        function getStatusColor(status) {
            const colors = {
                'Aktif': '#16a34a',
                'YaklaÅŸan': '#2563eb',
                'TamamlandÄ±': '#6b7280',
                'Ä°ptal': '#dc2626'
            };
            return colors[status] || '#6b7280';
        }

        // Sayfa gÃ¼ncellendiÄŸinde context menu'larÄ± ekle
        document.addEventListener('DOMContentLoaded', function () {
            setTimeout(addContextMenuToStudentRows, 2000);

            // MutationObserver ile yeni eklenen satÄ±rlarÄ± yakala
            const observer = new MutationObserver(function (mutations) {
                mutations.forEach(function (mutation) {
                    if (mutation.addedNodes) {
                        setTimeout(addContextMenuToStudentRows, 100);
                    }
                });
            });

            const studentsTable = document.getElementById('students-tbody');
            if (studentsTable) {
                observer.observe(studentsTable, { childList: true });
            }
        });

        // Global fonksiyonlarÄ± tanÄ±mla
        window.quickUpdateStudentStatus = quickUpdateStudentStatus;
        window.showStudentContextMenu = showStudentContextMenu;
        window.removeContextMenu = removeContextMenu;
        window.addContextMenuToStudentRows = addContextMenuToStudentRows;

        console.log('ðŸŽ¯ GeliÅŸmiÅŸ Ã¶ÄŸrenci yÃ¶netim Ã¶zellikleri aktif!');
    </script>

    <!-- Klavye KÄ±sayollarÄ± -->
    <script>
        // Klavye kÄ±sayollarÄ±
        document.addEventListener('keydown', function (e) {
            // Ctrl+E: SeÃ§ili Ã¶ÄŸrenciyi dÃ¼zenle
            if (e.ctrlKey && e.key === 'e' && !e.target.matches('input, textarea, select')) {
                e.preventDefault();
                const selectedCheckbox = document.querySelector('.student-checkbox:checked');
                if (selectedCheckbox) {
                    editStudentDetails(parseInt(selectedCheckbox.value));
                }
            }

            // Ctrl+D: SeÃ§ili Ã¶ÄŸrenciyi kopyala
            if (e.ctrlKey && e.key === 'd' && !e.target.matches('input, textarea, select')) {
                e.preventDefault();
                const selectedCheckbox = document.querySelector('.student-checkbox:checked');
                if (selectedCheckbox) {
                    duplicateStudent(parseInt(selectedCheckbox.value));
                }
            }

            // Delete: SeÃ§ili Ã¶ÄŸrencileri sil
            if (e.key === 'Delete' && !e.target.matches('input, textarea, select')) {
                const selectedCheckboxes = document.querySelectorAll('.student-checkbox:checked');
                if (selectedCheckboxes.length > 0) {
                    const studentIds = Array.from(selectedCheckboxes).map(cb => parseInt(cb.value));
                    if (confirm(`${studentIds.length} Ã¶ÄŸrenciyi silmek istediÄŸinizden emin misiniz?`)) {
                        Promise.all(studentIds.map(id => window.db.deleteOgrenci(id)))
                            .then(() => {
                                showNotification(`${studentIds.length} Ã¶ÄŸrenci silindi`, 'success');
                                window.loadTermStudents(window.appState.currentTermId);
                            })
                            .catch(() => {
                                showNotification('Silme iÅŸlemi sÄ±rasÄ±nda hata oluÅŸtu', 'error');
                            });
                    }
                }
            }
        });

        // YardÄ±m modalÄ±
        function showKeyboardShortcuts() {
            const helpModal = `
        <div class="modal-overlay active" id="keyboardHelpModal">
            <div class="modal-container" style="max-width: 500px;">
                <div class="modal-header">
                    <h2>
                        <i class="fas fa-keyboard"></i>
                        Klavye KÄ±sayollarÄ±
                    </h2>
                    <button class="modal-close" onclick="closeKeyboardHelp()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div style="display: grid; gap: 12px;">
                        <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e5e7eb;">
                            <span><strong>Ctrl + E</strong></span>
                            <span>SeÃ§ili Ã¶ÄŸrenciyi dÃ¼zenle</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e5e7eb;">
                            <span><strong>Ctrl + D</strong></span>
                            <span>SeÃ§ili Ã¶ÄŸrenciyi kopyala</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e5e7eb;">
                            <span><strong>Delete</strong></span>
                            <span>SeÃ§ili Ã¶ÄŸrencileri sil</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e5e7eb;">
                            <span><strong>ESC</strong></span>
                            <span>ModallarÄ± kapat</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e5e7eb;">
                            <span><strong>SaÄŸ TÄ±k</strong></span>
                            <span>Ã–ÄŸrenci context menÃ¼sÃ¼</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 8px 0;">
                            <span><strong>F1</strong></span>
                            <span>Bu yardÄ±m menÃ¼sÃ¼</span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="closeKeyboardHelp()">
                        <i class="fas fa-check"></i>
                        AnladÄ±m
                    </button>
                </div>
            </div>
        </div>
    `;

            document.body.insertAdjacentHTML('beforeend', helpModal);
            document.body.style.overflow = 'hidden';
        }

        function closeKeyboardHelp() {
            const modal = document.getElementById('keyboardHelpModal');
            if (modal) {
                modal.remove();
                document.body.style.overflow = '';
            }
        }

        // F1 tuÅŸu ile yardÄ±m
        document.addEventListener('keydown', function (e) {
            if (e.key === 'F1') {
                e.preventDefault();
                showKeyboardShortcuts();
            }
        });

        window.showKeyboardShortcuts = showKeyboardShortcuts;
        window.closeKeyboardHelp = closeKeyboardHelp;

        console.log('âŒ¨ï¸ Klavye kÄ±sayollarÄ± aktif! F1 tuÅŸuna basarak yardÄ±m alabilirsiniz.');
    </script>

</body>

</html>